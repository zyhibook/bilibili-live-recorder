{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../constant.js","../share/index.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","export const BILIBILI = 'https://live.bilibili.com';\nexport const GITHUB = 'https://github.com/zhw2590582/bilibili-live-recorder';\nexport const WEBSTORE = 'https://chrome.google.com/webstore/category/extensions';\n\nexport const BEFORE_RECORD = 'before_record';\nexport const START_RECORD = 'start_record';\nexport const RECORDING = 'recording';\nexport const STOP_RECORD = 'stop_record';\nexport const AFTER_RECORD = 'after_record';\n\nexport const BEFORE_DOWNLOAD = 'before_download';\nexport const START_DOWNLOAD = 'start_download';\nexport const DOWNLOADING = 'downloading';\nexport const AFTER_DOWNLOAD = 'after_download';\n\nexport const MP4_BUFFER = 'mp4_buffer';\nexport const FLV_BUFFER = 'flv_buffer';\n","import { BILIBILI } from '../constant';\n\nexport function notify(text, name) {\n    chrome.notifications.create(String(Math.random()), {\n        type: 'basic',\n        iconUrl: chrome.extension.getURL('icons/icon128.png'),\n        title: 'Bilibili 直播间录制器',\n        message: name || '',\n        contextMessage: text,\n    });\n}\n\nexport function badge(text) {\n    chrome.browserAction.setBadgeText({ text: text });\n    chrome.browserAction.setBadgeBackgroundColor({ color: 'red' });\n}\n\nexport function isBilibiliRoom(url) {\n    const urlObj = new URL(url);\n    const isBilibili = urlObj.origin === BILIBILI;\n    const isRoom = /^\\d+$/.test(urlObj.pathname.slice(1));\n    return isBilibili && isRoom;\n}\n\nexport function getNowTime() {\n    if (performance && typeof performance.now === 'function') {\n        return performance.now();\n    }\n    return Date.now();\n}\n\nexport function sleep(ms = 0) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function clamp(num, a, b) {\n    return Math.max(Math.min(num, Math.max(a, b)), Math.min(a, b));\n}\n\nexport function calculationRate(callback) {\n    let totalSize = 0;\n    let lastTime = getNowTime();\n    return size => {\n        totalSize += size;\n        const thisTime = getNowTime();\n        const diffTime = thisTime - lastTime;\n        if (diffTime >= 1000) {\n            callback((totalSize / diffTime) * 1000);\n            lastTime = thisTime;\n            totalSize = 0;\n        }\n    };\n}\n\nexport function mergeBuffer(...buffers) {\n    const Cons = buffers[0].constructor;\n    return buffers.reduce((pre, val) => {\n        const merge = new Cons((pre.byteLength | 0) + (val.byteLength | 0));\n        merge.set(pre, 0);\n        merge.set(val, pre.byteLength | 0);\n        return merge;\n    }, new Cons());\n}\n\nexport function download(url, name) {\n    const elink = document.createElement('a');\n    elink.style.display = 'none';\n    elink.href = url;\n    elink.download = name;\n    document.body.appendChild(elink);\n    elink.click();\n    document.body.removeChild(elink);\n}\n","import { sleep } from '../../share';\nimport { BILIBILI, MP4_BUFFER, FLV_BUFFER } from '../../constant';\n\nclass Content {\n    constructor() {\n        const $script = document.createElement('script');\n        $script.src = chrome.extension.getURL('injected/index.js');\n        $script.onload = () => $script.remove();\n        (document.head || document.body || document.documentElement).appendChild($script);\n\n        const $style = document.createElement('link');\n        $style.rel = 'stylesheet';\n        $style.type = 'text/css';\n        $style.href = chrome.extension.getURL('injected/index.css');\n        sleep().then(() => document.head.appendChild($style));\n\n        window.addEventListener('message', event => {\n            if (event.origin !== BILIBILI) return;\n            const { type, data } = event.data;\n            switch (type) {\n                case MP4_BUFFER:\n                    chrome.runtime.sendMessage({\n                        type: MP4_BUFFER,\n                        data: data,\n                    });\n                    break;\n                case FLV_BUFFER:\n                    chrome.runtime.sendMessage({\n                        type: FLV_BUFFER,\n                        data: data,\n                    });\n                    break;\n                default:\n                    break;\n            }\n        });\n    }\n}\n\nexport default new Content();\n"],"names":["BILIBILI","MP4_BUFFER","FLV_BUFFER","sleep","ms","Promise","resolve","setTimeout","Content","$script","document","createElement","src","chrome","extension","getURL","onload","remove","head","body","documentElement","appendChild","$style","rel","type","href","then","window","addEventListener","event","origin","data","runtime","sendMessage"],"mappings":";;;;;;EAAA,SAAS,eAAe,CAAC,QAAQ,EAAE,WAAW,EAAE;IAC9C,IAAI,EAAE,QAAQ,YAAY,WAAW,CAAC,EAAE;MACtC,MAAM,IAAI,SAAS,CAAC,mCAAmC,CAAC,CAAC;KAC1D;GACF;;EAED,kBAAc,GAAG,eAAe;;ECNzB,IAAMA,QAAQ,GAAG,2BAAjB;AACP,EAcO,IAAMC,UAAU,GAAG,YAAnB;AACP,EAAO,IAAMC,UAAU,GAAG,YAAnB;;ECeA,SAASC,KAAT,GAAuB;EAAA,MAARC,EAAQ,uEAAH,CAAG;EAC1B,SAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO;EAAA,WAAIC,UAAU,CAACD,OAAD,EAAUF,EAAV,CAAd;EAAA,GAAnB,CAAP;EACH;;MC9BKI,UACF,mBAAc;EAAA;;EACV,MAAMC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAhB;EACAF,EAAAA,OAAO,CAACG,GAAR,GAAcC,MAAM,CAACC,SAAP,CAAiBC,MAAjB,CAAwB,mBAAxB,CAAd;;EACAN,EAAAA,OAAO,CAACO,MAAR,GAAiB;EAAA,WAAMP,OAAO,CAACQ,MAAR,EAAN;EAAA,GAAjB;;EACA,GAACP,QAAQ,CAACQ,IAAT,IAAiBR,QAAQ,CAACS,IAA1B,IAAkCT,QAAQ,CAACU,eAA5C,EAA6DC,WAA7D,CAAyEZ,OAAzE;EAEA,MAAMa,MAAM,GAAGZ,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAf;EACAW,EAAAA,MAAM,CAACC,GAAP,GAAa,YAAb;EACAD,EAAAA,MAAM,CAACE,IAAP,GAAc,UAAd;EACAF,EAAAA,MAAM,CAACG,IAAP,GAAcZ,MAAM,CAACC,SAAP,CAAiBC,MAAjB,CAAwB,oBAAxB,CAAd;EACAZ,EAAAA,KAAK,GAAGuB,IAAR,CAAa;EAAA,WAAMhB,QAAQ,CAACQ,IAAT,CAAcG,WAAd,CAA0BC,MAA1B,CAAN;EAAA,GAAb;EAEAK,EAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,UAAAC,KAAK,EAAI;EACxC,QAAIA,KAAK,CAACC,MAAN,KAAiB9B,QAArB,EAA+B;EADS,sBAEjB6B,KAAK,CAACE,IAFW;EAAA,QAEhCP,IAFgC,eAEhCA,IAFgC;EAAA,QAE1BO,IAF0B,eAE1BA,IAF0B;;EAGxC,YAAQP,IAAR;EACI,WAAKvB,UAAL;EACIY,QAAAA,MAAM,CAACmB,OAAP,CAAeC,WAAf,CAA2B;EACvBT,UAAAA,IAAI,EAAEvB,UADiB;EAEvB8B,UAAAA,IAAI,EAAEA;EAFiB,SAA3B;EAIA;;EACJ,WAAK7B,UAAL;EACIW,QAAAA,MAAM,CAACmB,OAAP,CAAeC,WAAf,CAA2B;EACvBT,UAAAA,IAAI,EAAEtB,UADiB;EAEvB6B,UAAAA,IAAI,EAAEA;EAFiB,SAA3B;EAIA;;EACJ;EACI;EAdR;EAgBH,GAnBD;EAoBH;;AAGL,cAAe,IAAIvB,OAAJ,EAAf;;;;;;;;"}