{"version":3,"file":"index.js","sources":["../../node_modules/crx-hotreload/hot-reload.js","dev/index.js"],"sourcesContent":["const filesInDirectory = dir => new Promise (resolve =>\n\n    dir.createReader ().readEntries (entries =>\n\n        Promise.all (entries.filter (e => e.name[0] !== '.').map (e =>\n\n            e.isDirectory\n                ? filesInDirectory (e)\n                : new Promise (resolve => e.file (resolve))\n        ))\n        .then (files => [].concat (...files))\n        .then (resolve)\n    )\n)\n\nconst timestampForFilesInDirectory = dir =>\n        filesInDirectory (dir).then (files =>\n            files.map (f => f.name + f.lastModifiedDate).join ())\n\nconst reload = () => {\n\n    chrome.tabs.query ({ active: true, currentWindow: true }, tabs => { // NB: see https://github.com/xpl/crx-hotreload/issues/5\n\n        if (tabs[0]) { chrome.tabs.reload (tabs[0].id) }\n\n        chrome.runtime.reload ()\n    })\n}\n\nconst watchChanges = (dir, lastTimestamp) => {\n\n    timestampForFilesInDirectory (dir).then (timestamp => {\n\n        if (!lastTimestamp || (lastTimestamp === timestamp)) {\n\n            setTimeout (() => watchChanges (dir, timestamp), 1000) // retry after 1s\n\n        } else {\n\n            reload ()\n        }\n    })\n\n}\n\nchrome.management.getSelf (self => {\n\n    if (self.installType === 'development') {\n\n        chrome.runtime.getPackageDirectoryEntry (dir => watchChanges (dir))\n    }\n})\n","import 'crx-hotreload';\n\n// 修改B站CSP请求头\nchrome.webRequest.onHeadersReceived.addListener(\n    details => {\n        let header = details.responseHeaders.find(event => {\n            const name = event.name.toLowerCase();\n            return name === 'content-security-policy-report-only' || name === 'content-security-policy';\n        });\n        if (header && header.value) {\n            header.value = 'worker-src blob: ; ' + header.value;\n        }\n        return { responseHeaders: details.responseHeaders };\n    },\n    { urls: ['*://*.bilibili.com/*'] },\n    ['blocking', 'responseHeaders'],\n);\n"],"names":["chrome","webRequest","onHeadersReceived","addListener","details","header","responseHeaders","find","event","name","toLowerCase","value","urls"],"mappings":";;;IAAA,MAAM,gBAAgB,GAAG,GAAG,IAAI,IAAI,OAAO,EAAE,OAAO;;IAEpD,IAAI,GAAG,CAAC,YAAY,GAAG,CAAC,WAAW,EAAE,OAAO;;IAE5C,QAAQ,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;;IAEnE,YAAY,CAAC,CAAC,WAAW;IACzB,kBAAkB,gBAAgB,EAAE,CAAC,CAAC;IACtC,kBAAkB,IAAI,OAAO,EAAE,OAAO,IAAI,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IAC3D,SAAS,CAAC;IACV,SAAS,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,MAAM,EAAE,GAAG,KAAK,CAAC,CAAC;IAC7C,SAAS,IAAI,EAAE,OAAO,CAAC;IACvB,KAAK;IACL,EAAC;;IAED,MAAM,4BAA4B,GAAG,GAAG;IACxC,QAAQ,gBAAgB,EAAE,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK;IAC1C,YAAY,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,gBAAgB,CAAC,CAAC,IAAI,GAAG,EAAC;;IAEjE,MAAM,MAAM,GAAG,MAAM;;IAErB,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,EAAE,IAAI,IAAI;;IAEtE,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,EAAC,EAAE;;IAExD,QAAQ,MAAM,CAAC,OAAO,CAAC,MAAM,IAAG;IAChC,KAAK,EAAC;IACN,EAAC;;IAED,MAAM,YAAY,GAAG,CAAC,GAAG,EAAE,aAAa,KAAK;;IAE7C,IAAI,4BAA4B,EAAE,GAAG,CAAC,CAAC,IAAI,EAAE,SAAS,IAAI;;IAE1D,QAAQ,IAAI,CAAC,aAAa,KAAK,aAAa,KAAK,SAAS,CAAC,EAAE;;IAE7D,YAAY,UAAU,EAAE,MAAM,YAAY,EAAE,GAAG,EAAE,SAAS,CAAC,EAAE,IAAI,EAAC;;IAElE,SAAS,MAAM;;IAEf,YAAY,MAAM,IAAG;IACrB,SAAS;IACT,KAAK,EAAC;;IAEN,EAAC;;IAED,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,IAAI,IAAI;;IAEnC,IAAI,IAAI,IAAI,CAAC,WAAW,KAAK,aAAa,EAAE;;IAE5C,QAAQ,MAAM,CAAC,OAAO,CAAC,wBAAwB,EAAE,GAAG,IAAI,YAAY,EAAE,GAAG,CAAC,EAAC;IAC3E,KAAK;IACL,CAAC,CAAC;;IChDFA,MAAM,CAACC,UAAP,CAAkBC,iBAAlB,CAAoCC,WAApC,CACI,UAAAC,OAAO,EAAI;IACP,MAAIC,MAAM,GAAGD,OAAO,CAACE,eAAR,CAAwBC,IAAxB,CAA6B,UAAAC,KAAK,EAAI;IAC/C,QAAMC,IAAI,GAAGD,KAAK,CAACC,IAAN,CAAWC,WAAX,EAAb;IACA,WAAOD,IAAI,KAAK,qCAAT,IAAkDA,IAAI,KAAK,yBAAlE;IACH,GAHY,CAAb;;IAIA,MAAIJ,MAAM,IAAIA,MAAM,CAACM,KAArB,EAA4B;IACxBN,IAAAA,MAAM,CAACM,KAAP,GAAe,wBAAwBN,MAAM,CAACM,KAA9C;IACH;;IACD,SAAO;IAAEL,IAAAA,eAAe,EAAEF,OAAO,CAACE;IAA3B,GAAP;IACH,CAVL,EAWI;IAAEM,EAAAA,IAAI,EAAE,CAAC,sBAAD;IAAR,CAXJ,EAYI,CAAC,UAAD,EAAa,iBAAb,CAZJ;;;;"}