{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/defineProperty.js","../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/crx-hotreload/hot-reload.js","../share/constant.js","dev/index.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","const filesInDirectory = dir => new Promise (resolve =>\n\n    dir.createReader ().readEntries (entries =>\n\n        Promise.all (entries.filter (e => e.name[0] !== '.').map (e =>\n\n            e.isDirectory\n                ? filesInDirectory (e)\n                : new Promise (resolve => e.file (resolve))\n        ))\n        .then (files => [].concat (...files))\n        .then (resolve)\n    )\n)\n\nconst timestampForFilesInDirectory = dir =>\n        filesInDirectory (dir).then (files =>\n            files.map (f => f.name + f.lastModifiedDate).join ())\n\nconst reload = () => {\n\n    chrome.tabs.query ({ active: true, currentWindow: true }, tabs => { // NB: see https://github.com/xpl/crx-hotreload/issues/5\n\n        if (tabs[0]) { chrome.tabs.reload (tabs[0].id) }\n\n        chrome.runtime.reload ()\n    })\n}\n\nconst watchChanges = (dir, lastTimestamp) => {\n\n    timestampForFilesInDirectory (dir).then (timestamp => {\n\n        if (!lastTimestamp || (lastTimestamp === timestamp)) {\n\n            setTimeout (() => watchChanges (dir, timestamp), 1000) // retry after 1s\n\n        } else {\n\n            reload ()\n        }\n    })\n\n}\n\nchrome.management.getSelf (self => {\n\n    if (self.installType === 'development') {\n\n        chrome.runtime.getPackageDirectoryEntry (dir => watchChanges (dir))\n    }\n})\n","export const BILIBILI = 'https://live.bilibili.com';\nexport const GITHUB = 'https://github.com/zhw2590582/bilibili-live-recorder';\nexport const WEBSTORE = 'https://chrome.google.com/webstore/category/extensions';\n\nexport const BEFORE_RECORD = 'before_record';\nexport const START_RECORD = 'start_record';\nexport const RECORDING = 'recording';\nexport const STOP_RECORD = 'stop_record';\nexport const AFTER_RECORD = 'after_record';\n\nexport const BEFORE_DOWNLOAD = 'before_download';\nexport const START_DOWNLOAD = 'start_download';\nexport const DOWNLOADING = 'downloading';\nexport const AFTER_DOWNLOAD = 'after_download';\n\nexport const MP4_BUFFER = 'mp4_buffer';\nexport const FLV_BUFFER = 'flv_buffer';\n\nexport const UPDATE_CONFIG = 'update_config';\n\nexport const TITLE_REPLACE = ' - 哔哩哔哩直播，二次元弹幕直播平台';\nexport const OPEN_LIVE = '请先打开Bilibili直播间';\nexport const RECORD_CREATED = '录制任务创建成功';\nexport const RECORD_STOP = '录制任务已经停止';\nexport const RECORD_DOWNLOAD = '录制文件开始下载！';\n","import 'crx-hotreload';\nimport {\n    START_RECORD,\n    STOP_RECORD,\n    RECORDING,\n    AFTER_RECORD,\n    START_DOWNLOAD,\n    BEFORE_RECORD,\n} from '../../share/constant';\n\nclass Background {\n    constructor() {\n        chrome.runtime.onMessage.addListener((request, sender, callback) => {\n            const { type, data } = request;\n            switch (type) {\n                case START_RECORD:\n                    this.config = data;\n                    this.updateConfig({\n                        state: RECORDING,\n                    });\n                    break;\n                case STOP_RECORD:\n                    this.updateConfig({\n                        state: AFTER_RECORD,\n                    });\n                    break;\n                case START_DOWNLOAD:\n                    this.updateConfig({\n                        state: BEFORE_RECORD,\n                    });\n                default:\n                    break;\n            }\n            callback();\n        });\n\n        chrome.notifications.onClicked.addListener(id => {\n            chrome.notifications.clear(id);\n        });\n    }\n\n    updateConfig(config) {\n        this.config = {\n            ...this.config,\n            ...config,\n        };\n    }\n}\n\nexport default new Background();\n"],"names":["BEFORE_RECORD","START_RECORD","RECORDING","STOP_RECORD","AFTER_RECORD","START_DOWNLOAD","Background","chrome","runtime","onMessage","addListener","request","sender","callback","type","data","config","updateConfig","state","notifications","onClicked","id","clear"],"mappings":"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"}