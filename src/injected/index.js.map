{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/setPrototypeOf.js","../../node_modules/@babel/runtime/helpers/construct.js","../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../share/index.js","../../node_modules/@babel/runtime/helpers/defineProperty.js","../share/storage.js","dev/index.js"],"sourcesContent":["function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    module.exports = _construct = Reflect.construct;\n  } else {\n    module.exports = _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nmodule.exports = _construct;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export function sleep(ms = 0) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function download(url, name) {\n    const elink = document.createElement('a');\n    elink.style.display = 'none';\n    elink.href = url;\n    elink.download = name;\n    document.body.appendChild(elink);\n    elink.click();\n    document.body.removeChild(elink);\n}\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","export default class Storage {\n    constructor(name) {\n        this.name = name;\n    }\n\n    get(key) {\n        const storage = JSON.parse(window.localStorage.getItem(this.name)) || {};\n        return key ? storage[key] : storage;\n    }\n\n    set(key, value) {\n        const storage = { ...this.get(), [key]: value };\n        window.localStorage.setItem(this.name, JSON.stringify(storage));\n    }\n\n    del(key) {\n        const storage = this.get();\n        delete storage[key];\n        window.localStorage.setItem(this.name, JSON.stringify(storage));\n    }\n\n    clean() {\n        window.localStorage.removeItem(this.name);\n    }\n}\n","import './index.scss';\nimport { sleep, download } from '../../share';\nimport Storage from '../../share/storage';\n\nclass Injected {\n    constructor() {\n        this.name = 'bilibili-live-recorder';\n        this.storage = new Storage(this.name);\n        this.worker = new Worker('./worker.js');\n        this.loading = false;\n\n        this.worker.onmessage = event => {\n            const { type, data } = event.data;\n            switch (type) {\n                case 'report':\n                    if (this.$container) {\n                        this.$duration.textContent = data.duration;\n                        this.$size.textContent = data.size;\n                    }\n                    break;\n                case 'download':\n                    download(data, `${document.title}.flv`);\n                    this.changeState('before-record');\n                    this.worker.terminate();\n                    this.$duration.textContent = '00:00';\n                    this.$size.textContent = '0.00M';\n                    break;\n                case 'error':\n                    this.loading = false;\n                    this.changeState('after-record');\n                    break;\n                default:\n                    break;\n            }\n        };\n\n        if (this.storage.get(location.href)) {\n            this.storage.del(location.href);\n            this.loading = true;\n            this.intercept();\n        }\n\n        sleep(1000).then(() => {\n            this.createUI();\n        });\n    }\n\n    // 创建UI\n    createUI() {\n        if (!document.body) {\n            return sleep(100).then(() => {\n                return this.createUI();\n            });\n        }\n\n        this.$container = document.createElement('div');\n        this.$container.classList.add(this.name);\n        this.$container.innerHTML = `\n            <div class=\"blr-states\">\n                <div class=\"blr-state blr-state-before-record blr-active\">开始</div>\n                <div class=\"blr-state blr-state-recording\">停止</div>\n                <div class=\"blr-state blr-state-after-record\">下载</div>\n                <div class=\"blr-state blr-state-wait\">稍等</div>\n            </div>\n            <div class=\"blr-monitors\">\n                <div class=\"blr-monitor blr-monitor-top\">\n                    <div class=\"blr-monitor-name\">时长：</div>\n                    <div class=\"blr-monitor-value blr-duration\">00:00</div>\n                </div>\n                <div class=\"blr-monitor blr-monitor-bottom\">\n                    <div class=\"blr-monitor-name\">大小：</div>\n                    <div class=\"blr-monitor-value blr-size\">0.00M</div>\n                </div>\n            </div>\n        `;\n        this.$states = Array.from(this.$container.querySelectorAll('.blr-state'));\n        this.$beforeRecord = this.$container.querySelector('.blr-state-before-record');\n        this.$recording = this.$container.querySelector('.blr-state-recording');\n        this.$afterRecord = this.$container.querySelector('.blr-state-after-record');\n        this.$duration = this.$container.querySelector('.blr-duration');\n        this.$size = this.$container.querySelector('.blr-size');\n        this.$monitor = this.$container.querySelector('.blr-monitor');\n\n        if (this.loading) {\n            this.changeState('recording');\n        } else if (location.href.includes('blr')) {\n            this.storage.clean();\n            this.$container.classList.add('blr-focus');\n            sleep(10000).then(() => {\n                this.$container.classList.remove('blr-focus');\n            });\n        }\n\n        const x = this.storage.get('x');\n        const y = this.storage.get('y');\n        if (x && y) {\n            this.$container.style.left = `${x}px`;\n            this.$container.style.top = `${y}px`;\n        }\n\n        document.body.appendChild(this.$container);\n        this.bindEvent();\n    }\n\n    // 更改状态\n    changeState(state) {\n        this.$states.forEach(item => {\n            if (item.classList.contains(`blr-state-${state}`)) {\n                item.classList.add('blr-active');\n            } else {\n                item.classList.remove('blr-active');\n            }\n        });\n    }\n\n    // 绑定事件\n    bindEvent() {\n        this.$beforeRecord.addEventListener('click', () => {\n            const $video = document.querySelector('video');\n            if ($video) {\n                this.storage.set(location.href, Date.now());\n                location.reload();\n            }\n        });\n\n        this.$recording.addEventListener('click', () => {\n            this.loading = false;\n            this.changeState('after-record');\n            this.worker.postMessage({\n                type: 'stop',\n            });\n        });\n\n        this.$afterRecord.addEventListener('click', () => {\n            this.loading = false;\n            this.changeState('wait');\n            this.worker.postMessage({\n                type: 'download',\n            });\n        });\n\n        let isDroging = false;\n        let lastPageX = 0;\n        let lastPageY = 0;\n        let lastPlayerLeft = 0;\n        let lastPlayerTop = 0;\n\n        this.$monitor.addEventListener('mousedown', () => {\n            isDroging = true;\n            lastPageX = event.pageX;\n            lastPageY = event.pageY;\n            lastPlayerLeft = this.$container.offsetLeft;\n            lastPlayerTop = this.$container.offsetTop;\n        });\n\n        document.addEventListener('mousemove', event => {\n            if (isDroging) {\n                const x = event.pageX - lastPageX;\n                const y = event.pageY - lastPageY;\n                this.$container.style.transform = `translate(${x}px, ${y}px)`;\n            }\n        });\n\n        document.addEventListener('mouseup', () => {\n            if (isDroging) {\n                isDroging = false;\n                this.$container.style.transform = 'translate(0, 0)';\n                const x = lastPlayerLeft + event.pageX - lastPageX;\n                const y = lastPlayerTop + event.pageY - lastPageY;\n                this.$container.style.left = `${x}px`;\n                this.$container.style.top = `${y}px`;\n                this.storage.set('x', x);\n                this.storage.set('y', y);\n            }\n        });\n    }\n\n    // 拦截视频流\n    intercept() {\n        const that = this;\n        const { read } = ReadableStreamDefaultReader.prototype;\n        ReadableStreamDefaultReader.prototype.read = function() {\n            const promiseResult = read.call(this);\n            promiseResult.then(({ done, value }) => {\n                if (done || !that.loading) return;\n                that.worker.postMessage({\n                    type: 'load',\n                    data: value,\n                });\n            });\n            return promiseResult;\n        };\n\n        const B = window.Blob;\n        window.Blob = function(array, options) {\n            let data = array[0];\n            if (options.type === 'text/javascript') {\n                data = `var read=ReadableStreamDefaultReader.prototype.read;ReadableStreamDefaultReader.prototype.read=function(){var e=read.call(this);return e.then(function(e){postMessage({type:\"blr-load\",data:e})}),e};\\n${data}`;\n            }\n            return new B([data], options);\n        };\n\n        const W = window.Worker;\n        window.Worker = function(...args) {\n            if (args[0].slice(0, 5) === 'data:') return;\n            const worker = new W(...args);\n            worker.onmessage = event => {\n                const { type, data } = event.data;\n                switch (type) {\n                    case 'blr-load':\n                        if (data.done || !that.loading) return;\n                        that.worker.postMessage({\n                            type: 'load',\n                            data: data.value,\n                        });\n                        break;\n                    default:\n                        break;\n                }\n            };\n            return worker;\n        };\n    }\n}\n\nexport default new Injected();\n"],"names":["sleep","ms","Promise","resolve","setTimeout","download","url","name","elink","document","createElement","style","display","href","body","appendChild","click","removeChild","Storage","key","storage","JSON","parse","window","localStorage","getItem","value","get","setItem","stringify","removeItem","Injected","worker","Worker","URL","loading","onmessage","event","data","type","$container","$duration","textContent","duration","$size","size","title","changeState","terminate","location","del","intercept","then","createUI","classList","add","innerHTML","$states","Array","from","querySelectorAll","$beforeRecord","querySelector","$recording","$afterRecord","$monitor","includes","clean","remove","x","y","left","top","bindEvent","state","forEach","item","contains","addEventListener","$video","set","Date","now","reload","postMessage","isDroging","lastPageX","lastPageY","lastPlayerLeft","lastPlayerTop","pageX","pageY","offsetLeft","offsetTop","transform","that","read","ReadableStreamDefaultReader","prototype","promiseResult","call","done","B","Blob","array","options","W","args","slice"],"mappings":"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"}