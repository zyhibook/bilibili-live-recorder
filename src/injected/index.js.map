{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/@babel/runtime/helpers/defineProperty.js","../share/storage.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","export default class Storage {\n    constructor(name) {\n        this.name = name;\n    }\n\n    get(key) {\n        const storage = JSON.parse(window.localStorage.getItem(this.name)) || {};\n        return key ? storage[key] : storage;\n    }\n\n    set(key, value) {\n        const storage = { ...this.get(), [key]: value };\n        window.localStorage.setItem(this.name, JSON.stringify(storage));\n    }\n\n    del(key) {\n        const storage = this.get();\n        delete storage[key];\n        window.localStorage.setItem(this.name, JSON.stringify(storage));\n    }\n\n    clean() {\n        window.localStorage.removeItem(this.name);\n    }\n}\n","import './index.scss';\nimport Storage from '../../share/storage';\n\nclass Injected {\n    constructor() {\n        this.name = 'bilibili-live-recorder';\n        this.storage = new Storage(this.name);\n        this.createUI();\n\n        if (this.storage.get(location.href)) {\n            this.storage.del(location.href);\n            this.intercept();\n        }\n    }\n\n    // 创建UI\n    createUI() {\n        this.$container = document.createElement('div');\n        this.$container.classList.add(this.name);\n        this.$container.innerHTML = `\n            <div class=\"${this.name}-states\">\n                <div class=\"${this.name}-state ${this.name}-state-before-record show\">开始录制</div>\n                <div class=\"${this.name}-state ${this.name}-state-recording\">停止录制</div>\n                <div class=\"${this.name}-state ${this.name}-state-after-record\">下载视频</div>\n            </div>\n            <div class=\"${this.name}-monitor\">\n                <div class=\"${this.name}-monitor-top\">时长：24:23:59</div>\n                <div class=\"${this.name}-monitor-bottom\">大小：12.345M</div>\n            </div>\n            <div class=\"${this.name}-handle\"></div>\n        `;\n        document.body.appendChild(this.$container);\n    }\n\n    // 开始录制\n    start() {\n        this.storage.set(location.href, 1);\n    }\n\n    // 拦截视频流\n    intercept() {\n        const { read } = ReadableStreamDefaultReader.prototype;\n        const that = this;\n        ReadableStreamDefaultReader.prototype.read = function() {\n            const promiseResult = read.call(this);\n            promiseResult.then(({ done, value }) => {\n                if (done) return;\n                that.read(value.slice());\n            });\n            return promiseResult;\n        };\n    }\n\n    read(uint8) {\n        //\n    }\n}\n\nexport default new Injected();\n"],"names":["Storage","name","key","storage","JSON","parse","window","localStorage","getItem","value","get","setItem","stringify","removeItem","Injected","createUI","location","href","del","intercept","$container","document","createElement","classList","add","innerHTML","body","appendChild","set","read","ReadableStreamDefaultReader","prototype","that","promiseResult","call","then","done","slice","uint8"],"mappings":"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"}