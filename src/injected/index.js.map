{"version":3,"file":"index.js","sources":["../../node_modules/_@babel_runtime@7.9.6@@babel/runtime/helpers/classCallCheck.js","../../node_modules/_@babel_runtime@7.9.6@@babel/runtime/helpers/createClass.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","import './index.scss';\n\nclass Injected {\n    constructor() {\n        this.blobs = [];\n        this.src = '';\n        this.timer = null;\n        this.video = null;\n        this.stream = null;\n        this.mediaRecorder = null;\n        if (/^https?:\\/\\/live/i.test(window.location.href)) {\n            this.createUI();\n            this.bindEvent();\n        }\n    }\n\n    static get options() {\n        return {\n            audioBitsPerSecond: 128000,\n            videoBitsPerSecond: 5000000,\n            mimeType: 'video/webm; codecs=\"vp8, opus\"',\n        };\n    }\n\n    get size() {\n        return this.blobs.reduce((size, item) => size + item.size, 0);\n    }\n\n    log(msg) {\n        throw new Error(`录播姬 --> ${msg}`);\n    }\n\n    durationToTime(duration) {\n        const m = String(Math.floor(duration / 60)).slice(-5);\n        const s = String(duration % 60);\n        return `${m.length === 1 ? `0${m}` : m}:${s.length === 1 ? `0${s}` : s}`;\n    }\n\n    mergeBlobs(blobs = []) {\n        const { size } = this;\n        let result = new Blob([]);\n\n        const tasks = blobs.map((blob) => () => {\n            return new Promise((resolve) => {\n                setTimeout(() => {\n                    result = new Blob([result, blob]);\n                    this.$wait.textContent = `${Math.floor((result.size / size || 0) * 100)}%`;\n                    resolve();\n                }, 0);\n            });\n        });\n\n        return new Promise((resolve) => {\n            (function loop() {\n                const task = tasks.shift();\n                if (task) {\n                    task().then(loop);\n                } else {\n                    resolve(result);\n                }\n            })();\n        });\n    }\n\n    createUI() {\n        this.$container = document.createElement('div');\n        this.$container.classList.add('bilibili-live-recorder');\n        this.$container.innerHTML = `\n            <div class=\"blr-states\">\n                <div class=\"blr-state blr-state-before-record blr-active\">开始</div>\n                <div class=\"blr-state blr-state-recording\">停止</div>\n                <div class=\"blr-state blr-state-after-record\">下载</div>\n                <div class=\"blr-state blr-state-wait\">0%</div>\n            </div>\n            <div class=\"blr-monitors\">\n                <div class=\"blr-monitor blr-monitor-top\">\n                    <div class=\"blr-monitor-name\">时长：</div>\n                    <div class=\"blr-monitor-value blr-duration\">00:00</div>\n                </div>\n                <div class=\"blr-monitor blr-monitor-bottom\">\n                    <div class=\"blr-monitor-name\">大小：</div>\n                    <div class=\"blr-monitor-value blr-size\">0.00M</div>\n                </div>\n            </div>\n        `;\n\n        this.$states = Array.from(this.$container.querySelectorAll('.blr-state'));\n        this.$beforeRecord = this.$container.querySelector('.blr-state-before-record');\n        this.$recording = this.$container.querySelector('.blr-state-recording');\n        this.$afterRecord = this.$container.querySelector('.blr-state-after-record');\n        this.$wait = this.$container.querySelector('.blr-state-wait');\n        this.$duration = this.$container.querySelector('.blr-duration');\n        this.$size = this.$container.querySelector('.blr-size');\n        this.$monitor = this.$container.querySelector('.blr-monitor');\n        this.$container.classList.add('blr-focus');\n        document.body.appendChild(this.$container);\n\n        setTimeout(() => {\n            this.$container.classList.remove('blr-focus');\n        }, 3000);\n    }\n\n    bindEvent() {\n        this.$beforeRecord.addEventListener('click', () => {\n            this.start();\n        });\n\n        this.$recording.addEventListener('click', () => {\n            this.stop();\n        });\n\n        this.$afterRecord.addEventListener('click', () => {\n            if (this.blobs.length) {\n                this.download().then(() => {\n                    this.reset();\n                });\n            } else {\n                this.reset();\n            }\n        });\n\n        let isDroging = false;\n        let lastPageX = 0;\n        let lastPageY = 0;\n        let lastPlayerLeft = 0;\n        let lastPlayerTop = 0;\n\n        this.$monitor.addEventListener('mousedown', (event) => {\n            isDroging = true;\n            lastPageX = event.pageX;\n            lastPageY = event.pageY;\n            lastPlayerLeft = this.$container.offsetLeft;\n            lastPlayerTop = this.$container.offsetTop;\n        });\n\n        document.addEventListener('mousemove', (event) => {\n            if (isDroging) {\n                const x = event.pageX - lastPageX;\n                const y = event.pageY - lastPageY;\n                this.$container.style.transform = `translate(${x}px, ${y}px)`;\n            }\n        });\n\n        document.addEventListener('mouseup', (event) => {\n            if (isDroging) {\n                isDroging = false;\n                this.$container.style.transform = 'translate(0, 0)';\n                const x = lastPlayerLeft + event.pageX - lastPageX;\n                const y = lastPlayerTop + event.pageY - lastPageY;\n                this.$container.style.left = `${x}px`;\n                this.$container.style.top = `${y}px`;\n            }\n        });\n    }\n\n    start() {\n        clearInterval(this.timer);\n        if (this.mediaRecorder) this.mediaRecorder.stop();\n        const videos = Array.from(document.querySelectorAll('video'));\n        if (videos.length) {\n            this.video = videos.find((item) => item.captureStream);\n            if (this.video) {\n                try {\n                    this.src = this.video.src;\n                    this.video.crossOrigin = 'anonymous';\n                    this.stream = this.video.captureStream();\n                    this.changeState('recording');\n                    if (MediaRecorder && MediaRecorder.isTypeSupported(Injected.options.mimeType)) {\n                        this.mediaRecorder = new MediaRecorder(this.stream, Injected.options);\n                        this.mediaRecorder.ondataavailable = (event) => {\n                            this.blobs.push(event.data);\n                            const size = this.size / 1024 / 1024;\n                            this.$size.textContent = `${size.toFixed(2).slice(-8)}M`;\n                            this.$duration.textContent = this.durationToTime(\n                                this.blobs.filter((item) => item.size > 1024).length,\n                            );\n                        };\n                        this.mediaRecorder.start(1000);\n                        this.timer = setInterval(() => {\n                            if (this.video && this.video.src && this.src !== this.video.src) {\n                                if (this.blobs.length) {\n                                    this.start();\n                                } else {\n                                    this.stop();\n                                }\n                            }\n                        }, 1000);\n                    } else {\n                        this.reset();\n                        this.log(`不支持录制格式：${Injected.options.mimeType}`);\n                    }\n                } catch (error) {\n                    this.reset();\n                    this.log(`录制视频流失败：${error.message.trim()}`);\n                }\n            } else {\n                this.reset();\n                this.log('未发现视频流');\n            }\n        } else {\n            this.reset();\n            this.log('未发现视频元素');\n        }\n    }\n\n    stop() {\n        clearInterval(this.timer);\n        this.changeState('after-record');\n        if (this.mediaRecorder) {\n            this.mediaRecorder.stop();\n        }\n    }\n\n    download() {\n        this.changeState('wait');\n        return this.mergeBlobs(this.blobs).then((blob) => {\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(blob);\n            link.download = `${document.title || Date.now()}.webm`;\n            link.style.display = 'none';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n        });\n    }\n\n    reset() {\n        clearInterval(this.timer);\n        this.changeState('before-record');\n        this.blobs = [];\n        this.src = '';\n        this.timer = null;\n        this.video = null;\n        this.stream = null;\n        this.mediaRecorder = null;\n        this.$duration.textContent = '00:00';\n        this.$size.textContent = '0.00M';\n        this.$wait.textContent = '0%';\n    }\n\n    changeState(state) {\n        this.$states.forEach((item) => {\n            if (item.classList.contains(`blr-state-${state}`)) {\n                item.classList.add('blr-active');\n            } else {\n                item.classList.remove('blr-active');\n            }\n        });\n    }\n}\n\nexport default new Injected();\n"],"names":["Injected","blobs","src","timer","video","stream","mediaRecorder","test","window","location","href","createUI","bindEvent","msg","Error","duration","m","String","Math","floor","slice","s","length","size","result","Blob","tasks","map","blob","Promise","resolve","setTimeout","$wait","textContent","loop","task","shift","then","$container","document","createElement","classList","add","innerHTML","$states","Array","from","querySelectorAll","$beforeRecord","querySelector","$recording","$afterRecord","$duration","$size","$monitor","body","appendChild","remove","addEventListener","start","stop","download","reset","isDroging","lastPageX","lastPageY","lastPlayerLeft","lastPlayerTop","event","pageX","pageY","offsetLeft","offsetTop","x","y","style","transform","left","top","clearInterval","videos","find","item","captureStream","crossOrigin","changeState","MediaRecorder","isTypeSupported","options","mimeType","ondataavailable","push","data","toFixed","durationToTime","filter","setInterval","log","error","message","trim","mergeBlobs","link","URL","createObjectURL","title","Date","now","display","click","removeChild","state","forEach","contains","reduce","audioBitsPerSecond","videoBitsPerSecond"],"mappings":"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"}