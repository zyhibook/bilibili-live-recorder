/*!
 * bilibili-live-recorder v1.0.0
 * Github: undefined
 * (c) 2018-2019 Harvey Zack
 * Released under the MIT License.
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Background=n()}(this,(function(){"use strict";var e=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")};function n(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var r=function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e};const t=e=>new Promise(n=>e.createReader().readEntries(e=>Promise.all(e.filter(e=>"."!==e.name[0]).map(e=>e.isDirectory?t(e):new Promise(n=>e.file(n)))).then(e=>[].concat(...e)).then(n))),o=(e,n)=>{(e=>t(e).then(e=>e.map(e=>e.name+e.lastModifiedDate).join()))(e).then(r=>{n&&n!==r?chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]&&chrome.tabs.reload(e[0].id),chrome.runtime.reload()}):setTimeout(()=>o(e,r),1e3)})};chrome.management.getSelf(e=>{"development"===e.installType&&chrome.runtime.getPackageDirectoryEntry(e=>o(e))});return new(function(){function n(){e(this,n),this.changeCSP(),chrome.notifications.onClicked.addListener((function(e){chrome.notifications.clear(e)}))}return r(n,[{key:"changeCSP",value:function(){chrome.webRequest.onHeadersReceived.addListener((function(e){var n=e.responseHeaders.find((function(e){return"content-security-policy-report-only"===e.name.toLowerCase()}));return n&&n.value&&(n.value="worker-src blob: ; "+n.value),{responseHeaders:e.responseHeaders}}),{urls:["*://*.bilibili.com/*"]},["blocking","responseHeaders"])}}]),n}())}));
